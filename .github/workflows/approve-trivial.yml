name: Auto-Approve Trivial PRs

on:
  pull_request_target:

permissions:
  pull-requests: write
  contents: read

jobs:
  auto-approve:
    runs-on: ubuntu-latest
    steps:
      - name: Check if PR has the 'trivial' label
        id: check-label
        run: |
          # Transform the PR URL to the correct API endpoint
          ISSUE_URL="${{ github.event.pull_request.url }}"  # Example: https://api.github.com/repos/owner/repo/pulls/184
          ISSUE_URL="${ISSUE_URL/pulls/issues}"  # Replace "/pulls/" with "/issues/"
      
          # Fetch labels from the transformed URL
          labels=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            "$ISSUE_URL/labels" | jq -r '.[].name')
      
          echo "Fetched labels: $labels"  # Debugging output
      
          if echo "$labels" | grep -q "trivial"; then
            echo "HAS_LABEL=true" >> $GITHUB_ENV
          else
            echo "HAS_LABEL=false" >> $GITHUB_ENV
          fi
      - name: Auto-approve PR if labeled 'trivial'
        if: env.HAS_LABEL == 'true'
        uses: hmarr/auto-approve-action@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
