name: Auto-Approve Trivial PRs

on:
  pull_request_target:

permissions:
  pull-requests: write
  contents: read

jobs:
  auto-approve:
    runs-on: ubuntu-latest
    steps:
      - name: Check if PR has the 'trivial' label
        id: check-label
        run: |
          labels=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            "${{ github.event.pull_request.url }}/labels" | jq -r '.[].name')
          
          if echo "$labels" | grep -q "trivial"; then
            echo "HAS_LABEL=true" >> $GITHUB_ENV
          else
            echo "HAS_LABEL=false" >> $GITHUB_ENV
          fi
      - name: Auto-approve PR if labeled 'trivial'
        if: env.HAS_LABEL == 'true'
        uses: hmarr/auto-approve-action@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
