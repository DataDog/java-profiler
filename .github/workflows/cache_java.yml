name: Cache Java Distributions

on:
  workflow_dispatch:

env:
  JDKS_DIR: jdks
  JAVA_BUILD_VERSION: 11.0.26-tem
  JAVA_8_VERSION: 8.0.442
  JAVA_11_VERSION: 11.0.26
  JAVA_17_VERSION: 17.0.14
  JAVA_21_VERSION: 21.0.6
  JAVA_23_VERSION: 23.0.2

  GRAAL_17_VERSION: 17.0.12
  GRAAL_21_VERSION: 21.0.6
  GRAAL_23_VERSION: 23.0.2

permissions:
  contents: read
  actions: read

jobs:
  cache-amd64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup OS
        run: |
          sudo apt-get update -y
          sudo apt-get install -y curl zip unzip
          mkdir jdks
      - name: Install SDKMAN
        run: |
          curl -s "https://get.sdkman.io" | bash
          source ~/.sdkman/bin/sdkman-init.sh
      - name: Cache Build JDK [amd64]
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk
          key: jdk-amd64-${{ github.run_id }}
          restore-keys: |
            jdk-amd64-
      - name: Cache JDK 8
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk8
          key: jdk8-amd64-${{ github.run_id }}
          restore-keys: |
            jdk8-amd64-
      - name: Cache JDK 11
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk11
          key: jdk11-amd64-${{ github.run_id }}
          restore-keys: |
            jdk11-amd64-
      - name: Cache JDK 17
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk17
          key: jdk17-amd64-${{ github.run_id }}
          restore-keys: |
            jdk17-amd64-
      - name: Cache JDK 21
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk21
          key: jdk21-amd64-${{ github.run_id }}
          restore-keys: |
            jdk21-amd64-
      - name: Cache JDK 23
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk23
          key: jdk23-amd64-${{ github.run_id }}
          restore-keys: |
            jdk23-amd64-

      - name: Cache JDK 8 (J9)
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk8-j9
          key: jdk8-j9-amd64-${{ github.run_id }}
          restore-keys: |
            jdk8-j9-amd64-
      - name: Cache JDK 11 (J9)
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk11-j9
          key: jdk11-j9-amd64-${{ github.run_id }}
          restore-keys: |
            jdk11-j9-amd64-
      - name: Cache JDK 17 (J9)
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk17-j9
          key: jdk17-j9-amd64-${{ github.run_id }}
          restore-keys: |
            jdk17-j9-amd64-
      - name: Cache JDK 21 (J9)
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk21-j9
          key: jdk21-j9-amd64-${{ github.run_id }}
          restore-keys: |
            jdk21-j9-amd64-
      - name: Cache JDK 23 (J9)
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk23-j9
          key: jdk23-j9-amd64-${{ github.run_id }}
          restore-keys: |
            jdk23-j9-amd64-

      - name: Cache JDK 17 (GraalVM)
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk17-graal
          key: jdk17-graal-amd64-${{ github.run_id }}
          restore-keys: |
            jdk17-graal-amd64-
      - name: Cache JDK 21 (GraalVM)
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk21-graal
          key: jdk21-graal-amd64-${{ github.run_id }}
          restore-keys: |
            jdk21-graal-amd64-
      - name: Cache JDK 23 (GraalVM)
        uses: actions/cache@v3
        with:
          path: |
            ${{ env.JDKS_DIR }}/jdk23-graal
          key: jdk23-graal-amd64-${{ github.run_id }}
          restore-keys: |
            jdk23-graal-amd64-          

      - name: Install JDKs
        run: |
          source .github/scripts/java_setup.sh
          
          prepareJdk ${{ env.JAVA_BUILD_VERSION }}-tem ${{ env.JDKS_DIR }}/jdk

          prepareJdk ${{ env.JAVA_8_VERSION }}-tem ${{ env.JDKS_DIR }}/jdk8
          prepareJdk ${{ env.JAVA_8_VERSION }}-sem ${{ env.JDKS_DIR }}/jdk8-j9
          
          prepareJdk ${{ env.JAVA_11_VERSION }}-tem ${{ env.JDKS_DIR }}/jdk11
          prepareJdk ${{ env.JAVA_11_VERSION }}-sem ${{ env.JDKS_DIR }}/jdk11-j9
          
          prepareJdk ${{ env.JAVA_17_VERSION }}-tem ${{ env.JDKS_DIR }}/jdk17
          prepareJdk ${{ env.JAVA_17_VERSION }}-sem ${{ env.JDKS_DIR }}/jdk17-j9
          prepareJdk ${{ env.GRAAL_17_VERSION }}-graal ${{ env.JDKS_DIR }}/jdk17-graal
          
          prepareJdk ${{ env.JAVA_21_VERSION }}-tem ${{ env.JDKS_DIR }}/jdk21
          prepareJdk ${{ env.JAVA_21_VERSION }}-sem ${{ env.JDKS_DIR }}/jdk21-j9
          prepareJdk ${{ env.GRAAL_21_VERSION }}-graal ${{ env.JDKS_DIR }}/jdk21-graal
          
          prepareJdk ${{ env.JAVA_23_VERSION }}-tem ${{ env.JDKS_DIR }}/jdk23
          prepareJdk ${{ env.JAVA_23_VERSION }}-sem ${{ env.JDKS_DIR }}/jdk23-j9
          prepareJdk ${{ env.GRAAL_23_VERSION }}-graal ${{ env.JDKS_DIR }}/jdk23-graal
